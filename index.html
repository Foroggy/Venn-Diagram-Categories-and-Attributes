<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multi Venn Diagram with Legend</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/venn.js@0.2.20/venn.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; display: flex; }
    #legend {
      margin-right: 20px;
      min-width: 200px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      margin-right: 8px;
      border: 1px solid #000;
    }
    #venn {
      flex-grow: 1;
      width: 1400px;
      height: 1000px;
      position: relative;
    }
  </style>
</head>
<body>
  <div id="legend">
    <h3>Legend</h3>
    <div id="legend-items"></div>
  </div>

  <div>
    <h2>Multi Venn Diagram</h2>
    <p>Enter Categories and Attributes:</p>
    <table id="inputTable">
      <thead><tr><th>Categories</th><th>Attributes</th></tr></thead>
      <tbody></tbody>
    </table>
    <button onclick="addRow()">+ Add Row</button>
    <button onclick="generateVenn()">Generate Diagram</button>
    <div id="venn"></div>
  </div>

  <script>
    const tableBody = document.querySelector("#inputTable tbody");
    for (let i = 0; i < 15; i++) addRow();

    function addRow() {
      const row = document.createElement("tr");
      row.innerHTML = '<td><input type="text"></td><td><input type="text"></td>';
      tableBody.appendChild(row);
    }

    function generateVenn() {
      document.getElementById("legend-items").innerHTML = "";
      const colorMap = {};
      const rows = tableBody.querySelectorAll("tr");
      const categoryMap = {};
      let gapCount = 0;

      rows.forEach(row => {
        const sf = row.children[0].querySelector("input").value.trim();
        const centers = row.children[1].querySelector("input").value.trim().split(/,\s*/).filter(Boolean);
        if (!sf) return;
        if (centers.length === 0) gapCount++;
        else centers.forEach(center => {
          if (!categoryMap[sf]) categoryMap[sf] = new Set();
          categoryMap[sf].add(center);
        });
      });

      const categoryKeys = Object.keys(categoryMap);
      const sets = categoryKeys.map(c => ({ sets: [c], size: categoryMap[c].size }));

      for (let i = 0; i < categoryKeys.length; i++) {
        for (let j = i + 1; j < categoryKeys.length; j++) {
          const a = categoryMap[categoryKeys[i]];
          const b = categoryMap[categoryKeys[j]];
          const overlap = [...a].filter(x => b.has(x)).length;
          if (overlap > 0) sets.push({ sets: [categoryKeys[i], categoryKeys[j]], size: overlap });
        }
      }
      if (gapCount > 0) sets.push({ sets: ["GAP"], size: gapCount });

      const chart = venn.VennDiagram().width(1400).height(1000);
      d3.select("#venn").datum(sets).call(chart);

      // Capture colors for legend
      d3.selectAll(".venn-area").filter(d => d.sets.length === 1).each(function(d) {
        const fill = d3.select(this).select("path").style("fill");
        colorMap[d.sets[0]] = fill;

        // Add legend entry
        const item = document.createElement("div");
        item.className = "legend-item";
        const colorBox = document.createElement("div");
        colorBox.className = "legend-color";
        colorBox.style.backgroundColor = fill;
        const label = document.createElement("span");
        label.textContent = d.sets[0];
        item.appendChild(colorBox);
        item.appendChild(label);
        document.getElementById("legend-items").appendChild(item);
      });
    }
  </script>
</body>
</html>



